<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>íŠ¹ìˆ˜ë¬¸ì ê²€ì‚¬ê¸°</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --bg: #f5f7fa;
        --card-bg: #fff;
        --text: #333;
        --accent: #2c3e50;
      }
      body.dark {
        --bg: #1e1e1e;
        --card-bg: #2a2a2a;
        --text: #eee;
        --accent: #79b8ff;
      }
      * {
        box-sizing: border-box;
      }
      body {
        background: var(--bg);
        color: var(--text);
        font-family: "Segoe UI", sans-serif;
        padding: 2rem;
        transition: all 0.3s ease;
      }
      h2 {
        text-align: center;
        color: var(--accent);
      }
      .wrapper {
        display: flex;
        flex-direction: column;
      }
      textarea {
        height: 300px;
        padding: 1rem;
        font-size: 1rem;
        border-radius: 8px;
        background: var(--card-bg);
        color: var(--text);
        border: 1px solid #ccc;
        white-space: pre;
        font-family: monospace;
        resize: vertical;
        width: 100%;
        margin-bottom: 0.5rem;
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: center;
        margin-bottom: 1rem;
      }
      button {
        padding: 0.5rem 1rem;
        border-radius: 6px;
        border: none;
        background: var(--accent);
        color: white;
        font-weight: bold;
        cursor: pointer;
      }
      .results {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        justify-content: center;
        margin-top: 1rem;
      }
      .card {
        background: var(--card-bg);
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
        min-width: 100px;
        border: 2px solid transparent;
      }
      .even {
        border-color: #4caf50;
      }
      .odd {
        border-color: #e74c3c;
      }
      .symbol {
        font-size: 1.5rem;
        font-weight: bold;
      }
      canvas {
        max-width: 100%;
        margin-top: 2rem;
      }
      .mismatch-box {
        width: 100%;
        background: #ffe4e1;
        color: #c0392b;
        padding: 1rem;
        border-radius: 8px;
        font-size: 0.95rem;
        white-space: pre-wrap;
        margin-bottom: 1rem;
      }
      #manualModal {
        display: none;
        position: fixed;
        top: 10%;
        left: 10%;
        width: 80%;
        height: 80%;
        background: var(--card-bg);
        color: var(--text);
        border: 2px solid var(--accent);
        border-radius: 10px;
        overflow: auto;
        padding: 2rem;
        z-index: 9999;
      }
    </style>
  </head>
  <body>
    <h2>íŠ¹ìˆ˜ë¬¸ì ê²€ì‚¬ê¸°</h2>

    <div class="controls">
      <button onclick="showManual()">ğŸ“˜ ì‚¬ìš©ì„¤ëª…ì„œ</button>
      <button onclick="resetText()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
      <button onclick="pasteFromClipboard()">ğŸ“¥ ë¶™ì—¬ë„£ê¸°</button>
      <button onclick="autoCorrect()">ğŸ› ï¸ ì˜¤ë¥˜ ë¶€ë¶„ í‘œì‹œ</button>
      <button onclick="copyToClipboard()">ğŸ“‹ ë³µì‚¬</button>
      <button onclick="downloadResult()">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</button>
      <button onclick="toggleTheme()">ï¿½ï¿½/â˜€ï¸ í…Œë§ˆ ì „í™˜</button>
      <button onclick="openSpellChecker()">ğŸ“ ë§ì¶¤ë²• ê²€ì‚¬</button>
    </div>

    <div class="wrapper">
      <textarea
        id="inputText"
        placeholder="ì—¬ê¸°ì— í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."
      ></textarea>
      <div class="mismatch" id="mismatchBox"></div>
    </div>

    <div class="results" id="output"></div>
    <canvas id="chart" height="100"></canvas>

    <!-- ì‚¬ìš©ì„¤ëª…ì„œ ëª¨ë‹¬ -->
    <div id="manualModal">
      <h3>ğŸ“˜ íŠ¹ìˆ˜ë¬¸ì ê²€ì‚¬ê¸° ì‚¬ìš© ì„¤ëª…ì„œ</h3>
      <p>
        <strong>1. í…ìŠ¤íŠ¸ ì…ë ¥</strong><br />ê²€ì‚¬í•˜ê³  ì‹¶ì€ ë¬¸ì¥ì„ ìœ„ í…ìŠ¤íŠ¸
        ìƒìì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.
      </p>
      <p>
        <strong>2. ğŸ› ï¸ ì˜¤ë¥˜ ë¶€ë¶„ í‘œì‹œ</strong><br />ìŒì´ ë§ì§€ ì•ŠëŠ” íŠ¹ìˆ˜ë¬¸ìì—
        <code>ğŸ”º</code> í‘œì‹œê°€ ì¶”ê°€ë©ë‹ˆë‹¤.
      </p>
      <p>
        <strong>3. VV ì¹´ë“œ</strong><br />ë‘ ì¹¸ ê³µë°±(" ")ì´ ë°œê²¬ëœ íšŸìˆ˜ë¥¼ VV
        ì¹´ë“œë¡œ í™•ì¸í•©ë‹ˆë‹¤.
      </p>
      <p>
        <strong>4. âœ… / âš ï¸ ì¹´ë“œ</strong><br />ì§ì´ ë§ëŠ” ë¬¸ìëŠ” âœ…, í‹€ë¦¬ë©´ âš ï¸ìœ¼ë¡œ
        í‘œì‹œë©ë‹ˆë‹¤.
      </p>
      <p>
        <strong>5. ğŸ“Š í•˜ë‹¨ ì°¨íŠ¸</strong><br />íŠ¹ìˆ˜ë¬¸ìì˜ ì‚¬ìš© ë¹ˆë„ë¥¼ ê·¸ë˜í”„ë¡œ
        í™•ì¸í•˜ì„¸ìš”.
      </p>
      <p>
        <strong>6. ë³µì‚¬ / ì €ì¥</strong><br />ë³µì‚¬ ë²„íŠ¼ê³¼ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ìœ¼ë¡œ
        ê²°ê³¼ë¥¼ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
      <br /><button onclick="hideManual()">ë‹«ê¸°</button>
    </div>

    <script>
      const textarea = document.getElementById("inputText");
      const output = document.getElementById("output");
      const mismatchBox = document.getElementById("mismatchBox");
      const ctx = document.getElementById("chart").getContext("2d");
      const body = document.body;

      const symbolPairs = {
        "": "",
        "(": ")",
        "<": ">",
        "ã€Š": "ã€‹",
        "ã€": "ã€",
        "[": "]",
        "âŒœ": "âŒŸ",
        '"': '"',
        "'": "'",
      };

      const symbols = [
        "",
        "(",
        ")",
        "<",
        ">",
        "ã€Š",
        "ã€‹",
        "ã€",
        "ã€",
        "[",
        "]",
        "âŒœ",
        "âŒŸ",
        '"',
        "'",
        "*",
        ",",
        "~",
        "-",
        ":",
        ";",
        "!",
        "?",
        ".",
        "â€¦",
        "Â·",
        "â€¢",
      ];

      let chart;

      function countDoubleSpaces(text) {
        const matches = text.match(/  /g);
        return matches ? matches.length : 0;
      }

      function updateCounts() {
        const text = textarea.value;
        const counts = symbols.map((s) => {
          const count = (
            text.match(
              new RegExp(s.replace(/[-/\\^$*+?.()|[\]{}]/g, "\\$&"), "g")
            ) || []
          ).length;
          return { symbol: s, count };
        });

        const doubleSpaceCount = countDoubleSpaces(text);
        const mismatches = checkBalancedPairs(text);
        const unbalancedSet = new Set(mismatches.map((m) => m.char));

        output.innerHTML =
          counts
            .map(({ symbol, count }) => {
              const isPairCheck =
                symbol in symbolPairs ||
                Object.values(symbolPairs).includes(symbol);
              const isBalanced = !isPairCheck || !unbalancedSet.has(symbol);
              const icon = isBalanced ? "âœ…" : "âš ï¸";
              const cardClass = isBalanced ? "even" : "odd";

              return `<div class="card ${cardClass}">
              <div class="symbol">${symbol}</div>
              <div>${count}ê°œ ${icon}</div>
            </div>`;
            })
            .join("") +
          `<div class="card even">
     <div class="symbol">VV</div>
     <div>${doubleSpaceCount}ê°œ</div>
   </div>`;

        if (chart) chart.destroy();
        chart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: [...counts.map((c) => c.symbol), "VV"],
            datasets: [
              {
                label: "ë¬¸ì ê°œìˆ˜",
                data: [...counts.map((c) => c.count), doubleSpaceCount],
                backgroundColor: "#3498db",
              },
            ],
          },
          options: {
            responsive: true,
            plugins: { legend: { display: false } },
          },
        });

        mismatchBox.innerHTML = mismatches.length
          ? `<div class="mismatch-box">${mismatches
              .map(
                (m) =>
                  `â— ${m.type} â†’ ${m.line}í–‰ ${m.column}ë²ˆì§¸ ê¸€ì '${m.char}'`
              )
              .join("\n")}</div>`
          : "";
      }

      function checkBalancedPairs(text) {
        const openSet = Object.keys(symbolPairs);
        const closeSet = Object.values(symbolPairs);
        const stack = [];
        const mismatches = [];
        const lines = text.split("\n");
        let globalIndex = 0;

        for (let lineNum = 0; lineNum < lines.length; lineNum++) {
          const line = lines[lineNum];
          for (let i = 0; i < line.length; i++) {
            const char = line[i];

            if (char === '"' || char === "'") {
              const last = stack[stack.length - 1];
              if (last && last.char === char) {
                stack.pop();
              } else {
                stack.push({
                  char,
                  index: globalIndex + i,
                  line: lineNum + 1,
                  column: i + 1,
                });
              }
            } else if (openSet.includes(char)) {
              stack.push({
                char,
                index: globalIndex + i,
                line: lineNum + 1,
                column: i + 1,
              });
            } else if (closeSet.includes(char)) {
              const last = stack[stack.length - 1];
              if (last && symbolPairs[last.char] === char) {
                stack.pop();
              } else {
                mismatches.push({
                  type: "ë‹«í˜ë§Œ ìˆìŒ",
                  char,
                  index: globalIndex + i,
                  line: lineNum + 1,
                  column: i + 1,
                });
              }
            }
          }
          globalIndex += line.length + 1;
        }

        stack.forEach((item) => {
          mismatches.push({
            type: "ì—´ë¦¼ë§Œ ìˆìŒ",
            char: item.char,
            index: item.index,
            line: item.line,
            column: item.column,
          });
        });

        return mismatches;
      }

      function autoCorrect() {
        textarea.value = textarea.value.replace(/ğŸ”º/g, "");
        const text = textarea.value;
        const mismatches = checkBalancedPairs(text);

        if (mismatches.length === 0) {
          updateCounts();
          alert("âœ¨ ëª¨ë“  ìŒì´ ì˜¬ë°”ë¥´ê²Œ ë§ì¶°ì ¸ ìˆìŠµë‹ˆë‹¤!");
          return;
        }

        let newText = text.split("");
        mismatches.forEach((item) => {
          newText[item.index] = "ğŸ”º" + newText[item.index];
        });
        textarea.value = newText.join("");
        updateCounts();

        navigator.clipboard
          .writeText(textarea.value)
          .then(() => alert("ğŸ”§ ì˜¤ë¥˜ ìœ„ì¹˜ì— ğŸ”º í‘œì‹œí•˜ê³  ë³µì‚¬ ì™„ë£Œ!"))
          .catch(() => alert("âŒ ë³µì‚¬ ì‹¤íŒ¨!"));
      }

      function resetText() {
        textarea.value = "";
        updateCounts();
      }

      function pasteFromClipboard() {
        navigator.clipboard
          .readText()
          .then((text) => {
            textarea.value = text;
            updateCounts();
          })
          .catch(() => alert("âŒ ë¶™ì—¬ë„£ê¸° ì‹¤íŒ¨!"));
      }

      function copyToClipboard() {
        navigator.clipboard
          .writeText(textarea.value)
          .then(() => alert("ğŸ“‹ ë³µì‚¬ ì™„ë£Œ!"))
          .catch(() => alert("âŒ ë³µì‚¬ ì‹¤íŒ¨!"));
      }

      function downloadResult() {
        const blob = new Blob([textarea.value], { type: "text/plain" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "ë¬¸ì¥ê²°ê³¼.txt";
        link.click();
      }

      function toggleTheme() {
        body.classList.toggle("dark");
      }

      function showManual() {
        document.getElementById("manualModal").style.display = "block";
      }

      function hideManual() {
        document.getElementById("manualModal").style.display = "none";
      }

      function openSpellChecker() {
        const text = textarea.value;
        if (!text.trim()) {
          alert("ê²€ì‚¬í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
          return;
        }
        navigator.clipboard
          .writeText(text)
          .then(() => {
            alert(
              "í…ìŠ¤íŠ¸ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆ ì°½ì—ì„œ Ctrl+Vë¡œ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”."
            );
            window.open(
              "https://search.naver.com/search.naver?where=nexearch&sm=top_sug.pre&fbm=0&acr=1&acq=%ED%95%9C%EA%B5%AD%EC%96%B4+%EB%A7%9E%EC%B6%A4%EB%B2%95&qdt=0&ie=utf8&query=%ED%95%9C%EA%B5%AD%EC%96%B4+%EB%A7%9E%EC%B6%A4%EB%B2%95+%EA%B2%80%EC%82%AC%EA%B8%B0",
              "_blank"
            );
          })
          .catch(() => {
            alert("í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ ì£¼ì„¸ìš”.");
          });
      }

      textarea.addEventListener("input", updateCounts);
      updateCounts();
    </script>
  </body>
</html>
